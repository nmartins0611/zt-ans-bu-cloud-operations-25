= Lab Guide: Automating OS Patching on AWS
:toc:
:toc-title: Table of Contents
:sectnums:
:icons: font

This guide demonstrates how to create and run a job template to perform OS patching on EC2 instances.

*Estimated time to complete: 15 minutes*

---

== Lab Overview

Welcome to the lab on Cloud Operations. In this challenge, you will create a Job Template to automate the patching of Red Hat Enterprise Linux servers running on AWS. You will also generate and view a patching report.

First, log in to the Ansible Automation Platform UI with the following credentials.

.Login Credentials
[cols="1,2a"]
|===
| Username | `admin`
| Password | `ansible123!`
|===

---

== Task 1: Create and Run the Patching Job Template

In this task, you will configure and launch a job template that checks for available patches on a Linux host.

. **Navigate to the Templates page.**
+
From the left navigation menu, select *Templates*.

. **Initiate the creation of a new job template.**
+
Click the **Create template** button, then select **Create job template**.
+
image::https://github.com/HichamMourad/awsops25/blob/master/images/create_templates.png?raw=true[Create a new job template, 600, opts="border"]

. **Enter the job template details.**
+
Fill out the form with the following information:
+
[cols="1,1"]
|===
| Parameter | Value
| Name | `Linux Patching`
| Job Type | `Check`
| Inventory | `AWS Inventory`
| Project | `AWS Demo Project`
| Execution Environment | `Default execution environment`
| Playbook | `playbooks/lab2-patching.yml`
| Credentials | `RHEL on AWS - SSH KEY`
|===
+
TIP: To select the credential, you may need to first filter the *Credential Type* to `Machine`.

. **Save the job template.**
+
Scroll to the bottom and click the blue **Save** button.

. **Navigate to the Survey tab.**
+
At the top of the template's details page, click the **Survey** tab to add a user prompt.

. **Create a new survey question.**
+
Click the blue **Add** button.

. **Configure the survey question.**
+
Fill out the survey form with the following values:
+
[cols="1,1"]
|===
| Parameter | Value
| Question | `Enter the Linux Host you want to patch`
| Answer variable name | `HOSTS`
| Answer type | `Multiple Choice (single select)`
| Required | Check the box ☑️
| Multiple Choice Options | `rhel1`
|===

. **Set the default answer and save.**
+
Click the radio button next to `rhel1` to make it the default option, then click **Save**.

. **Enable the survey.**
+
You must **enable the survey** by clicking the toggle switch at the top of the survey page. The text will change from `SURVEY OFF` to `SURVEY ON`.
+
image::https://github.com/HichamMourad/awsops25/blob/master/images/survey_toggle_short.png?raw=true[Enable Survey Toggle, 600, opts="border"]

. **Launch the template.**
+
Click the **Launch** button in the top right.

. **Complete the survey and run the job.**
+
You will be prompted with the survey question. Since `rhel1` is already the default, click **Next**, review the details, and then click **Finish** to run the job.

NOTE: We set the *Job Type* to `Check`. This runs the playbook in "dry run" mode, showing what changes would be made without actually applying them. The job output will point to the patch reports, which we will examine in the next task.

---

== Task 2: View the Patching Report

The automation job generates HTML reports detailing the available patches.

. **Locate the report URLs in the job output.**
+
The output from the `Linux Patching` job will contain URLs for the generated reports. They will look similar to this:
+
* `http://<IP_ADDRESS>/reports/linux.html`
* `http://<IP_ADDRESS>/reports/linuxpatch.html`

. **View the reports.**
+
Copy and paste each URL into a new browser tab to view them. The `linuxpatch.html` report provides a detailed list of all package updates that would be installed or removed if the job were run in normal mode.

NOTE: While this challenge focuses on Linux, Ansible Automation Platform can be used to perform Windows patching with similar workflows.

---

== Next Steps

You have successfully completed this lab. Press the `Next` button in the lab environment to proceed to the next challenge.
