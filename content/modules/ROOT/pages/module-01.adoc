= Lab Guide: Automating Day-2 Cloud Operations
:notoc:
:toc-title: Table of Contents
:icons: font

An overview of day-2 cloud operations and how to automate common use cases on cloud operations topics.

*Estimated time to complete: 15 minutes*

---

== Lab Overview

Welcome to the `Ansible Hybrid Cloud Automation - Cloud Operations lab`. In this guide, you will learn how to automate Day-2 cloud operations. This first challenge focuses on understanding a pre-configured Dynamic Inventory and using tags to manage resources.

First, log in to the Ansible Automation Platform UI with the following credentials.

.Login Credentials
[cols="1,2a"]
|===
| Username | `admin`
| Password | `ansible123!`
|===

---

== Task 1: Understanding Credentials

Credentials are used for authentication when launching Jobs against machines, synchronizing with inventory sources, and importing project content from version control systems. In this lab, we use two pre-configured credentials:

* **RHEL on AWS - SSH KEY:** An SSH key for connecting to the Red Hat Enterprise Linux hosts running on AWS.
* **AWS_Credential:** An AWS credential for performing actions on the AWS cloud, such as creating a VPC or managing instances.

. **Navigate to the Credentials menu.**
+
In the Controller UI, go to the left navigation menu and select *Infrastructure* â†’ *Credentials*.
+
NOTE: Credential keys are encrypted. Once entered into the automation controller, no one, including administrators, can view the sensitive values.

---

== Task 2: AWS Inventory

In this task, you will create a new inventory to hold your dynamically discovered hosts from AWS.

. **Navigate to the Inventories menu.**
+
From the left navigation menu, select *Infrastructure* â†’ *Inventories*. Notice that there is an inventory that we've created for you called `AWS Inventory`.

. **Initiate inventory creation.**
+
Click on this inventory, and then select the `Sources` tab.

. **Enter the inventory details.**
+
Select the `AWS Source` and click on the `Launch inventory update` button.

. **Wait for the Status to show `Success`, then click on the `Hosts` tab to view the EC2 instances.**
+
You may need to click on the `Back to Inventory Sources` to see the `Hosts` tab. Here you will see the list of pre-deployed instances.
---

== Task 3: Create a job template to retrieve information about the EC2 Instances, and display the results to the screen.

. **Navigate to the Templates page.**
+
From the left navigation menu, select *Templates*.

. **Initiate the creation of a new job template.**
+
Click the **Create template** button, then select **Create job template**.
+
image::https://github.com/HichamMourad/awsops25/blob/master/images/create_templates.png?raw=true[Create a new job template, 600, opts="border"]

. **Enter the job template details.**
+
Fill out the form with the following information:
+
[cols="1,1"]
|===
| Parameter | Value
| Name | `Retrieve EC2 information`
| Inventory | `AWS Inventory`
| Project | `AWS Demo Project`
| Playbook | `playbooks/lab2-ec2-info.yml`
| Credentials | `AWS_Credential`
|===
+
TIP: For the `Credentials` you will have to select `Amazon Web Services` from the `Select Category` dropdown; then the `AWS_credential` will show up in the list to select.

. **Save the job template.**
+
Scroll to the bottom Click the blue `Create Job Template` button to **save** the job template.

. **Launch the `Retrieve EC2 information` job template.**
+
Select it and clicking on `Launch`, or by simply clicking the `Rocket Launcher` ðŸš€ icon.

. **Observe the output of the Job Template run.**
+
In a highly dynamic environment, the AWS Inventory (EC2 instances) can change very often.  So it's important to trigger an Inventory synchronization before we run the job template. Let's address this in the next task.
---

== Task 4: Create a Workflow Template to trigger an inventory synchronization, and run the job template.

. **Navigate to the Templates page.**
+
From the left navigation menu, select *Templates*.

. **Initiate the creation of a new workflow job template.**
+
Click the **Create template** button, then select **Create workflow job template**.
+
image::https://github.com/HichamMourad/awsops25/blob/master/images/create_templates.png?raw=true[Create a new workflow job template, 600, opts="border"]

. **Enter the job template details.**
+
Fill out the form with the following information:
+
[cols="1,1"]
|===
| Parameter | Value
| Name | `WORKFLOW - Retrieve EC2 information`
| Inventory | `AWS Inventory`
|===

. **Save the workflow job template.**
+
Scroll to the bottom and click `Create workflow job template`.

. **The Workflow visual designer will open.**
+
Click on the `Add step` button.

. **In the `+ Add step` dialog, expand the `Node Type` dropdown and select `Inventory Source Sync`**
+
From the `Inventory source` dropdown select the `AWS Source` and now click on `Next` below, and then `Finish` to save this step.

. **At this point you have the first node in the workflow that will trigger the AWS Inventory synchronization.**
+
On the node titled `AWS Source` select the `ellipsis (3 vertical dots)` and select the `+ Add step and link` to add another node to the workflow.

. **At this point the `Node Type` should be `Job Template`.**
+
From the `Job template` dropdown, select the `Retrieve EC2 information` job template from the list.

. **From the `Status` dropdown make sure `Run on success` is selected.**
+
This will make sure that we don't proceed to this step until the fist node in the workflow is completes successfully. Select `Next` below, and then `Finish` to save this step.

. **In the top left corner of the Workflow designer click on `Save` to save the Workflow Template.**
+
Back in the `Templates` link under the `Automation Execution` on the left navigation menu. Launch the workflow template `WORKFLOW - Retrieve EC2 information`. To see the job details you can select each workflow node, and go to the `Output` tab to see the details of that node execution.

. **In summary, this `Workflow template` made sure we updated the AWS inventory to the most recent inventory, and then retrieved the EC2 information that we desired.**
+
When you are done, please move on to the next challenge. Click `Next`.

---
== Next Steps

Press the `Next` button below to go to the next challenge once you've completed this challenge.
