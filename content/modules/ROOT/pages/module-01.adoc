= Lab Guide: Automating Day-2 Cloud Operations with AWS
:toc:
:toc-title: Table of Contents
:sectnums:
:icons: font

_A guide to using Ansible Automation Platform for Day-2 cloud operations, including dynamic inventories, job templates, and workflows._

---

== Lab Briefing

This section provides an overview of the lab environment and key concepts in Ansible Automation Platform.

=== Lab Instructions

Please click the green **Start** button on the bottom right corner to create the lab environment if it has not already started. To navigate through this briefing, click the white `>` arrow on the right.

image:https://github.com/IPvSean/pictures_for_github/blob/master/start_button.png?raw=true[Start Button, 100, opts="border"]

=== Automation controller

The control plane for Ansible Automation Platform is the **automation controller**. It helps standardize how automation is deployed, initiated, delegated, and audited. You can manage inventory, launch and schedule workflows, track changes, and integrate reporting, all from a centralized user interface and RESTful API.

image:https://github.com/IPvSean/pictures_for_github/blob/master/automation_controller.png?raw=true[Automation controller dashboard, 600, opts="border"]

=== Inventories

An **inventory** is a collection of hosts against which automation jobs can be launched, similar to an Ansible inventory file. Inventories are divided into groups, and these groups contain the actual hosts. Groups can be sourced manually or dynamically from a supported cloud provider using **Inventory Plugins**.

Some of the available inventory plugins include:

* Amazon Web Services EC2
* Google Compute Engine
* Microsoft Azure Resource Manager
* VMware vSphere and vCenter

=== Lab Diagram

The lab topology consists of one Ansible Automation Platform controller node and two Red Hat Enterprise Linux nodes running in Amazon Web Services (AWS) as Elastic Compute Cloud (EC2) instances.

image:https://github.com/IPvSean/pictures_for_github/blob/master/aws-diagram.png?raw=true[Lab topology diagram, 600, opts="border"]

=== Workflows

**Workflows** allow you to configure a sequence of disparate job templates that can be chained together. They can share inventory and permissions or use different ones, enabling you to build complex, multi-step automation processes.

image::https://github.com/HichamMourad/awsops25/blob/master/images/wf1.png?raw=true[Example of a workflow diagram, 900, opts="border"]

You can link:https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.5/html/using_automation_execution/controller-workflow-job-templates#controller-workflow-job-templates[read more about workflows in the documentation].

This concludes your lab briefing.

---

== Lab Guide: Hands-On Tasks

*Estimated time to complete: 15 minutes*

Welcome to the `Ansible Hybrid Cloud Automation - Cloud Operations lab`. In this first challenge, you will learn about the pre-configured Dynamic Inventory for this lab and how it uses tags to identify resources.

=== Task 1: Understanding Credentials

First, you will log in and examine the pre-configured credentials for this lab.

. **Navigate to the Automation Controller UI.**
+
Click on the **Automation Controller** tab at the top of your lab window.

. **Log in with the provided credentials.**
+
[cols="1,2a"]
|===
| Username | `admin`
| Password | `ansible123!`
|===

. **Examine the pre-configured credentials.**
+
In this lab, we use two different credentials:
+
* **RHEL on AWS - SSH KEY:** An SSH key for connecting to the RHEL hosts.
* **AWS_Credential:** An AWS credential for performing actions on the cloud.
+
To view them, navigate to **Automation Execution** → **Infrastructure** → **Credentials** in the left navigation menu.

NOTE: Credential keys are encrypted. Once entered into the automation controller, no one, including administrators, can view the sensitive values.

=== Task 2: Synchronize the AWS Inventory

Next, you will synchronize the dynamic inventory to ensure the automation controller has the latest host information from AWS.

. **Navigate to the Inventories menu.**
+
In the left navigation menu, go to **Automation Execution** → **Infrastructure** → **Inventories**.

. **Select the AWS Inventory.**
+
Click on the inventory named `AWS Inventory`.

. **Synchronize the inventory source.**
+
Select the **Sources** tab and click the **Sync** button (the icon with two circling arrows). This will update the host list from AWS.

. **View the updated hosts.**
+
Wait for the synchronization job status to show **Success**, then click on the **Hosts** tab to view the discovered EC2 instances.

=== Task 3: Create a Job Template to Retrieve EC2 Information

Now, you will create a job template to run a playbook that gathers and displays information about your EC2 instances.

. **Navigate to the Templates page.**
+
In the left navigation menu, go to **Automation Execution** → **Templates**.

. **Initiate the creation of a new job template.**
+
Click the **Create template** button, then select **Create job template**.
+
image:https://github.com/HichamMourad/awsops25/blob/master/images/create_templates.png?raw=true[Create a new job template, 600, opts="border"]

. **Enter the job template details.**
+
Fill out the form with the following information:
+
[cols="1,1"]
|===
| Parameter | Value
| Name | `Retrieve EC2 information`
| Inventory | `AWS Inventory`
| Project | `AWS Demo Project`
| Playbook | `playbooks/lab2-ec2-info.yml`
| Credentials | `AWS_Credential`
|===
+
TIP: To select the `AWS_Credential`, you may need to first filter the *Credential Type* to `Amazon Web Services`.

. **Save and launch the job template.**
+
Scroll to the bottom, click **Save**, and then **Launch** the template. Observe the output of the job run.

NOTE: In a highly dynamic environment, the AWS inventory can change often. It's important to trigger an inventory synchronization before running jobs that rely on that inventory. We will address this in the next task.

=== Task 4: Build a Workflow to Sync and Retrieve Information

To ensure you are always working with the latest inventory, you will create a workflow that first syncs the AWS inventory and then runs the job template to retrieve EC2 information.

. **Navigate to the Templates page and initiate workflow creation.**
+
Go to **Automation Execution** → **Templates**, click the **Create template** button, and select **Create workflow job template**.
+
image:https://github.com/HichamMourad/awsops25/blob/master/images/create_templates.png?raw=true[Create a new workflow job template, 600, opts="border"]

. **Enter the workflow details.**
+
[cols="1,1"]
|===
| Parameter | Value
| Name | `WORKFLOW - Retrieve EC2 information`
| Inventory | `AWS Inventory`
|===
+
Click **Create workflow job template**. The Workflow Visualizer will open.

. **Add the first node (Inventory Sync).**
+
Click the **Start** button. In the *Add Node* dialog, configure the first step:
+
--
a. **Node Type:** Select `Inventory Source Sync`.
b. **Inventory Source:** Select `AWS Source`.
c. Click **Next**, then **Save**.
--

. **Add the second node (Job Template).**
+
Hover over the `AWS Source` node you just created, click the **+** icon, and select *Add node*. Configure it as follows:
+
--
a. **Run type:** Ensure `On Success` is selected.
b. **Node Type:** This should default to `Job Template`.
c. **Job Template:** Select `Retrieve EC2 information`.
d. Click **Next**, then **Save**.
--

. **Save and launch the workflow.**
+
In the top right corner of the Visualizer, click **Save**. Then, navigate back to the **Templates** page and launch the `WORKFLOW - Retrieve EC2 information` template.

This workflow ensures your inventory is always up-to-date before you attempt to gather information from it.

---

== Next Steps

You have successfully completed this lab. Press the `Next` button in your lab environment to proceed to the next challenge.
